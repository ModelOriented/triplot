<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Triplot overview • triplot</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- dalexverse -->
<link href="../dalexverse.css" rel="stylesheet">
<link href="../dalexverse-2.css" rel="stylesheet">

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>






<meta property="og:title" content="Triplot overview" />
<meta property="og:description" content="triplot" />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14""></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">triplot</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">1.2.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/vignette_aspect_importance.html">Triplot overview</a>
    </li>
    <li>
      <a href="../articles/vignette_aspect_importance_fifa.html">Usecase with FIFA 20 dataset</a>
    </li>
    <li>
      <a href="../articles/vignette_aspect_importance_indepth.html">Description of predict_aspects method</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/triplot/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>


<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Triplot overview</h1>
                        <h4 class="author">Katarzyna Pękala</h4>
            
            <h4 class="date">2020-06-04</h4>
      
      <small class="dont-index">Source: <a href='https://github.com/ModelOriented/triplot/blob/master/vignettes/vignette_aspect_importance.Rmd'><code>vignettes/vignette_aspect_importance.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_aspect_importance.Rmd</code></div>

    </div>

    
    
<div id="data-and-logistic-regression-model-for-titanic-survival" class="section level1">
<h1>Data and logistic regression model for Titanic survival</h1>
<p>Vignette presents the predict_aspects() function on the datasets: <code>titanic_imputed</code> and <code>apartments</code> (both are available in the <code>DALEX</code> package). At the beginning, we download <code>titanic_imputed</code> dataset and build logistic regression model.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>titanic &lt;-<span class="st"> </span>titanic_imputed</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">head</span>(titanic)</span></code></pre></div>
<pre><code>#&gt;   gender age class    embarked  fare sibsp parch survived
#&gt; 1   male  42   3rd Southampton  7.11     0     0        0
#&gt; 2   male  13   3rd Southampton 20.05     0     2        0
#&gt; 3   male  16   3rd Southampton 20.05     1     1        0
#&gt; 4 female  39   3rd Southampton 20.05     1     1        1
#&gt; 5 female  16   3rd Southampton  7.13     0     0        1
#&gt; 6   male  25   3rd Southampton  7.13     0     0        1</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>model_titanic_glm &lt;-</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span><span class="kw">glm</span>(survived <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span>class <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sibsp <span class="op">+</span><span class="st"> </span>parch <span class="op">+</span><span class="st"> </span>fare <span class="op">+</span><span class="st"> </span>embarked,</span>
<span id="cb3-3"><a href="#cb3-3"></a>      titanic,</span>
<span id="cb3-4"><a href="#cb3-4"></a>      <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span></code></pre></div>
</div>
<div id="preparing-additional-parameters" class="section level1">
<h1>Preparing additional parameters</h1>
<p>Before using predict_aspects() we need to:</p>
<ul>
<li>group features of the dataset into aspects,</li>
<li>choose observation for which we want to explain aspects’ importance.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>aspects_titanic &lt;-</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="st">  </span><span class="kw">list</span>(</span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="dt">wealth =</span> <span class="kw">c</span>(<span class="st">&quot;class&quot;</span>, <span class="st">&quot;fare&quot;</span>),</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="dt">family =</span> <span class="kw">c</span>(<span class="st">&quot;sibsp&quot;</span>, <span class="st">&quot;parch&quot;</span>),</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="dt">personal =</span> <span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;gender&quot;</span>),</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="dt">embarked =</span> <span class="st">&quot;embarked&quot;</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>  )</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a>passenger &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="dt">class =</span> <span class="kw">factor</span>(</span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="st">&quot;3rd&quot;</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a>    <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;1st&quot;</span>, <span class="st">&quot;2nd&quot;</span>, <span class="st">&quot;3rd&quot;</span>, <span class="st">&quot;deck crew&quot;</span>, <span class="st">&quot;engineering crew&quot;</span>, <span class="st">&quot;restaurant staff&quot;</span>, <span class="st">&quot;victualling crew&quot;</span>)),</span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>)),</span>
<span id="cb4-14"><a href="#cb4-14"></a>  <span class="dt">age =</span> <span class="dv">8</span>,</span>
<span id="cb4-15"><a href="#cb4-15"></a>  <span class="dt">sibsp =</span> <span class="dv">0</span>,</span>
<span id="cb4-16"><a href="#cb4-16"></a>  <span class="dt">parch =</span> <span class="dv">0</span>,</span>
<span id="cb4-17"><a href="#cb4-17"></a>  <span class="dt">fare =</span> <span class="dv">18</span>,</span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="dt">embarked =</span> <span class="kw">factor</span>(</span>
<span id="cb4-19"><a href="#cb4-19"></a>    <span class="st">&quot;Southampton&quot;</span>,</span>
<span id="cb4-20"><a href="#cb4-20"></a>    <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Belfast&quot;</span>, <span class="st">&quot;Cherbourg&quot;</span>, <span class="st">&quot;Queenstown&quot;</span>, <span class="st">&quot;Southampton&quot;</span>)</span>
<span id="cb4-21"><a href="#cb4-21"></a>  )</span>
<span id="cb4-22"><a href="#cb4-22"></a>)</span>
<span id="cb4-23"><a href="#cb4-23"></a></span>
<span id="cb4-24"><a href="#cb4-24"></a>passenger</span></code></pre></div>
<pre><code>#&gt;   class gender age sibsp parch fare    embarked
#&gt; 1   3rd   male   8     0     0   18 Southampton</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">predict</span>(model_titanic_glm, passenger, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>#&gt;         1 
#&gt; 0.1803217</code></pre>
</div>
<div id="calculating-aspect-importance-logistic-regression" class="section level1">
<h1>Calculating aspect importance (logistic regression)</h1>
<p>Now we can call predict_aspects() function and see that features included in <code>wealth</code> (that is <code>class</code> and <code>fare</code>) have the biggest contribution on survival prediction for the passenger. That contribution is of negative type. <code>Personal</code> and <code>family</code> have smaller, positive influence. Aspect <code>embarked</code> with single feature has very small contribution.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">library</span>(<span class="st">&quot;triplot&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a>titanic_without_target &lt;-<span class="st"> </span>titanic[,<span class="kw">colnames</span>(titanic) <span class="op">!=</span><span class="st"> &quot;survived&quot;</span>]</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a>explain_titanic_glm &lt;-<span class="st"> </span><span class="kw">explain</span>(model_titanic_glm, </span>
<span id="cb8-9"><a href="#cb8-9"></a>                      <span class="dt">data =</span> titanic_without_target,</span>
<span id="cb8-10"><a href="#cb8-10"></a>                      <span class="dt">y =</span> titanic<span class="op">$</span>survived <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb8-11"><a href="#cb8-11"></a>                      <span class="dt">predict_function =</span> predict,</span>
<span id="cb8-12"><a href="#cb8-12"></a>                      <span class="dt">label =</span> <span class="st">&quot;Logistic Regression&quot;</span>, </span>
<span id="cb8-13"><a href="#cb8-13"></a>                      <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb8-14"><a href="#cb8-14"></a></span>
<span id="cb8-15"><a href="#cb8-15"></a>titanic_glm_ai &lt;-<span class="st"> </span><span class="kw">predict_aspects</span>(explain_titanic_glm, </span>
<span id="cb8-16"><a href="#cb8-16"></a>                                    <span class="dt">new_observation =</span> passenger, </span>
<span id="cb8-17"><a href="#cb8-17"></a>                                    <span class="dt">variable_groups =</span> aspects_titanic, </span>
<span id="cb8-18"><a href="#cb8-18"></a>                                    <span class="dt">N =</span> <span class="dv">1000</span>)</span>
<span id="cb8-19"><a href="#cb8-19"></a></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="kw">print</span>(titanic_glm_ai, <span class="dt">show_features =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt;   variable_groups importance     features
#&gt; 2          wealth   -0.73927  class, fare
#&gt; 4        personal    0.34750  age, gender
#&gt; 3          family    0.16723 sibsp, parch
#&gt; 5        embarked   -0.02766     embarked</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">plot</span>(titanic_glm_ai) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Aspect importance for the selected passenger&quot;</span>)</span></code></pre></div>
<p><img src="C:/Users/Katarzyna/Dropbox/r/mi2/triplot/docs/articles/vignette_aspect_importance_files/figure-html/Calculating aspect importance (logistic regression)-1.png" width="700" style="display: block; margin: auto;" /></p>
</div>
<div id="random-forest-model-for-titanic-survival" class="section level1">
<h1>Random forest model for Titanic survival</h1>
<p>Now, we prepare random forest model for the <code>titanic</code> dataset.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>model_titanic_rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(<span class="kw">factor</span>(survived) <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">                                   </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>class <span class="op">+</span><span class="st"> </span>embarked <span class="op">+</span><span class="st"> </span>fare <span class="op">+</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">                                   </span>sibsp <span class="op">+</span><span class="st"> </span>parch,</span>
<span id="cb11-6"><a href="#cb11-6"></a>                                 <span class="dt">data =</span> titanic)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="kw">predict</span>(model_titanic_rf, passenger)</span></code></pre></div>
<pre><code>#&gt;         1 
#&gt; 0.5194387</code></pre>
</div>
<div id="calculating-aspect-importance-random-forest" class="section level1">
<h1>Calculating aspect importance (random forest)</h1>
<p>After calling predict_aspects() we can see why the survival prediction for the passenger in random forest model was much higher (0.5) than in logistic regression case (0.18).</p>
<p>In this example <code>personal</code> features (<code>age</code> and <code>gender</code>) have the biggest positive influence. Aspects <code>wealth</code> (<code>class</code>, <code>fare</code>) and <code>embarked</code> have both much smaller contribution and those are negative ones. Aspect <code>family</code> has very small influence on the prediction.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>explain_titanic_rf &lt;-<span class="st"> </span><span class="kw">explain</span>(model_titanic_rf, </span>
<span id="cb13-2"><a href="#cb13-2"></a>                      <span class="dt">data =</span> titanic_without_target,</span>
<span id="cb13-3"><a href="#cb13-3"></a>                      <span class="dt">y =</span> titanic<span class="op">$</span>survived <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb13-4"><a href="#cb13-4"></a>                      <span class="dt">predict_function =</span> predict,</span>
<span id="cb13-5"><a href="#cb13-5"></a>                      <span class="dt">label =</span> <span class="st">&quot;Random Forest&quot;</span>,</span>
<span id="cb13-6"><a href="#cb13-6"></a>                      <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a>titanic_rf_ai &lt;-<span class="st"> </span><span class="kw">predict_aspects</span>(explain_titanic_rf, </span>
<span id="cb13-9"><a href="#cb13-9"></a>                                 <span class="dt">new_observation =</span> passenger, </span>
<span id="cb13-10"><a href="#cb13-10"></a>                                 <span class="dt">variable_groups =</span> aspects_titanic, </span>
<span id="cb13-11"><a href="#cb13-11"></a>                                 <span class="dt">N =</span> <span class="dv">1000</span>)</span>
<span id="cb13-12"><a href="#cb13-12"></a></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="kw">print</span>(titanic_rf_ai, <span class="dt">show_features =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt;   variable_groups importance     features
#&gt; 4        personal   0.211406  age, gender
#&gt; 2          wealth  -0.071676  class, fare
#&gt; 5        embarked  -0.044127     embarked
#&gt; 3          family   0.002889 sibsp, parch</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">plot</span>(titanic_rf_ai) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Aspect importance for the selected passenger&quot;</span>)</span></code></pre></div>
<p><img src="C:/Users/Katarzyna/Dropbox/r/mi2/triplot/docs/articles/vignette_aspect_importance_files/figure-html/Calculating aspect importance (random forest)-1.png" width="700" style="display: block; margin: auto;" /></p>
</div>
<div id="using-lasso-in-predict_aspects-function" class="section level1">
<h1>Using lasso in predict_aspects() function</h1>
<p>Function predict_aspects() can calculate coefficients (that is aspects’ importance) by using either linear regression or lasso regression. Using lasso, we can control how many nonzero coefficients (nonzero aspects importance values) are present in the final explanation.</p>
<p>To use predict_aspects() with lasso, we have to provide <code>n_var</code> parameter, which declares how many aspects importance nonzero values we would like to get in predict_aspects() results.</p>
<p>For this example, we use <code>titanic_imputed</code> dataset again and random forest model. With the help of lasso technique, we would like to check the importance of variables’ aspects, while controlling that two of them should be equal to 0. Therefore we call predict_aspects() with <code>n_var</code> parameter set to 2.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>titanic_rf_ai_lasso &lt;-<span class="st"> </span><span class="kw">predict_aspects</span>(explain_titanic_rf, </span>
<span id="cb16-2"><a href="#cb16-2"></a>                                 <span class="dt">new_observation =</span> passenger, </span>
<span id="cb16-3"><a href="#cb16-3"></a>                                 <span class="dt">variable_groups =</span> aspects_titanic, </span>
<span id="cb16-4"><a href="#cb16-4"></a>                                 <span class="dt">N =</span> <span class="dv">1000</span>, </span>
<span id="cb16-5"><a href="#cb16-5"></a>                                 <span class="dt">n_var =</span> <span class="dv">2</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="kw">print</span>(titanic_rf_ai_lasso, <span class="dt">show_features =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt;   variable_groups importance     features
#&gt; 4        personal    0.23209  age, gender
#&gt; 2          wealth   -0.04034  class, fare
#&gt; 3          family    0.00000 sibsp, parch
#&gt; 5        embarked    0.00000     embarked</code></pre>
</div>
<div id="automated-grouping-features-into-aspects" class="section level1">
<h1>Automated grouping features into aspects</h1>
<p>In examples described above, we had to manually group features into aspects. On <code>apartments</code> dataset, we will test the function that automatically groups features for us (grouping is based on the features correlation). Function only works on numeric variables.</p>
<p>We import <code>apartments</code> from <code>DALEX</code> package and choose columns with numeric features. Then we fit linear model to the data and choose observation to be explained. Target variable is <code>m2.price</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">library</span>(DALEX)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="kw">data</span>(<span class="st">&quot;apartments&quot;</span>)</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a>apartments_num &lt;-<span class="st"> </span>apartments[,<span class="kw">unlist</span>(<span class="kw">lapply</span>(apartments, is.numeric))] <span class="co">#excluding non numeric features</span></span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="kw">head</span>(apartments_num)</span></code></pre></div>
<pre><code>#&gt;   m2.price construction.year surface floor no.rooms
#&gt; 1     5897              1953      25     3        1
#&gt; 2     1818              1992     143     9        5
#&gt; 3     3643              1937      56     1        2
#&gt; 4     3517              1995      93     7        3
#&gt; 5     3013              1992     144     6        5
#&gt; 6     5795              1926      61     6        2</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>new_observation_apartments &lt;-<span class="st"> </span>apartments_num[<span class="dv">6</span>,]</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>model_apartments &lt;-<span class="st"> </span><span class="kw">lm</span>(m2.price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> apartments_num)</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a>new_observation_apartments</span></code></pre></div>
<pre><code>#&gt;   m2.price construction.year surface floor no.rooms
#&gt; 6     5795              1926      61     6        2</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">predict</span>(model_apartments, new_observation_apartments) </span></code></pre></div>
<pre><code>#&gt;        6 
#&gt; 3817.634</code></pre>
<p>We run group_variables() function with cut off level set on 0.6. As a result, we get a list of variables groups (aspects) where absolute value of features’ pairwise correlation is at least at 0.6.</p>
<p>Afterwards, we call print predict_aspects() results with parameter <code>show_cor = TRUE</code>, to check how features are grouped into aspects, what is minimal value of pairwise correlation in each group and to check whether any pair of features is negatively correlated (<code>neg</code>) or not (<code>pos</code>).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>apartments_no_target &lt;-<span class="st"> </span>apartments_num[,<span class="op">-</span><span class="dv">1</span>] <span class="co">#excluding target variable</span></span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a>aspects_apartments &lt;-<span class="st"> </span><span class="kw">group_variables</span>(apartments_no_target, <span class="fl">0.6</span>)</span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a>explain_apartments_lm &lt;-<span class="st"> </span><span class="kw">explain</span>(model_apartments, </span>
<span id="cb24-6"><a href="#cb24-6"></a>                      <span class="dt">data =</span> apartments_no_target,</span>
<span id="cb24-7"><a href="#cb24-7"></a>                      <span class="dt">y =</span> apartments_num<span class="op">$</span>m2.price, </span>
<span id="cb24-8"><a href="#cb24-8"></a>                      <span class="dt">predict_function =</span> predict,</span>
<span id="cb24-9"><a href="#cb24-9"></a>                      <span class="dt">label =</span> <span class="st">&quot;Linear Model&quot;</span>,</span>
<span id="cb24-10"><a href="#cb24-10"></a>                      <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb24-11"><a href="#cb24-11"></a></span>
<span id="cb24-12"><a href="#cb24-12"></a>apartments_ai &lt;-<span class="st"> </span><span class="kw">predict_aspects</span>(<span class="dt">x =</span> explain_apartments_lm, </span>
<span id="cb24-13"><a href="#cb24-13"></a>                                 <span class="dt">new_observation =</span> new_observation_apartments[<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb24-14"><a href="#cb24-14"></a>                                 <span class="dt">variable_groups =</span> aspects_apartments,</span>
<span id="cb24-15"><a href="#cb24-15"></a>                                 <span class="dt">N =</span> <span class="dv">1000</span>)</span>
<span id="cb24-16"><a href="#cb24-16"></a></span>
<span id="cb24-17"><a href="#cb24-17"></a><span class="kw">print</span>(apartments_ai, <span class="dt">show_features =</span> <span class="ot">TRUE</span>, <span class="dt">show_cor =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt;   variable_groups importance          features   min_cor sign
#&gt; 3   aspect.group2     304.97 surface, no.rooms 0.9174349  pos
#&gt; 4   aspect.group3      17.62             floor        NA     
#&gt; 2   aspect.group1     -17.26 construction.year        NA</code></pre>
</div>
<div id="hierarchical-aspects-importance" class="section level1">
<h1>Hierarchical aspects importance</h1>
<p><code>Triplot</code> is one more tool that allows us to better understand the inner workings a of black box model. It illustrates, in one place:</p>
<ul>
<li>the importance of every single feature,</li>
<li>hierarchical aspects importance (explained below),</li>
<li>order of grouping features into aspects as in <code>group_variables()</code>.</li>
</ul>
<p>Hierarchical aspects importance allows us to check the values of aspects importance for the different levels of variables grouping. Method starts with looking at the aspect importance where every aspect has one, single variable. Afterwards, it iteratively creates bigger aspects by merging the ones with the highest level of absolute correlation into one aspect and calculating it’s contribution to the prediction. It should be noted that similarly to <code>group_variables()</code>, <code>calculate_triplot()</code> works for the datasets with only numerical variables.</p>
<p>Looking at the triplot, we can observe that for a given observation:</p>
<ul>
<li>surface have biggest impact on prediction,</li>
<li>every feature has positive influence on prediction,</li>
<li>surface and number of rooms are, unsurprisingly, strongly correlated and together they have strong influence on the prediction,</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a>apartments_tri &lt;-<span class="st"> </span><span class="kw">predict_triplot</span>(explain_apartments_lm, </span>
<span id="cb26-4"><a href="#cb26-4"></a>                         <span class="dt">new_observation =</span> new_observation_apartments[<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb26-5"><a href="#cb26-5"></a>                         <span class="dt">N =</span> <span class="dv">1000</span>,</span>
<span id="cb26-6"><a href="#cb26-6"></a>                         <span class="dt">clust_method =</span> <span class="st">&quot;complete&quot;</span>)</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="kw">plot</span>(apartments_tri, </span>
<span id="cb26-9"><a href="#cb26-9"></a>     <span class="dt">absolute_value =</span> <span class="ot">FALSE</span>,</span>
<span id="cb26-10"><a href="#cb26-10"></a>     <span class="dt">cumulative_max =</span> <span class="ot">FALSE</span>,</span>
<span id="cb26-11"><a href="#cb26-11"></a>     <span class="dt">add_importance_labels =</span> <span class="ot">FALSE</span>,</span>
<span id="cb26-12"><a href="#cb26-12"></a>     <span class="dt">abbrev_labels =</span> <span class="dv">15</span>,</span>
<span id="cb26-13"><a href="#cb26-13"></a>     <span class="dt">add_last_group =</span> <span class="ot">TRUE</span>,</span>
<span id="cb26-14"><a href="#cb26-14"></a>     <span class="dt">margin_mid =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="C:/Users/Katarzyna/Dropbox/r/mi2/triplot/docs/articles/vignette_aspect_importance_files/figure-html/unnamed-chunk-2-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="session-info" class="section level1">
<h1>Session info</h1>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>#&gt; R version 4.0.0 (2020-04-24)
#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)
#&gt; Running under: Windows 10 x64 (build 18362)
#&gt; 
#&gt; Matrix products: default
#&gt; 
#&gt; locale:
#&gt; [1] LC_COLLATE=Polish_Poland.1250  LC_CTYPE=Polish_Poland.1250   
#&gt; [3] LC_MONETARY=Polish_Poland.1250 LC_NUMERIC=C                  
#&gt; [5] LC_TIME=Polish_Poland.1250    
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] randomForest_4.6-14 triplot_1.2.0       ggplot2_3.3.1      
#&gt; [4] DALEX_1.2.1        
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.4.6     compiler_4.0.0   pillar_1.4.4     iterators_1.0.12
#&gt;  [5] tools_4.0.0      digest_0.6.25    lattice_0.20-41  evaluate_0.14   
#&gt;  [9] memoise_1.1.0    lifecycle_0.2.0  tibble_3.0.1     gtable_0.3.0    
#&gt; [13] pkgconfig_2.0.3  rlang_0.4.6      foreach_1.5.0    Matrix_1.2-18   
#&gt; [17] rstudioapi_0.11  patchwork_1.0.0  yaml_2.2.1       pkgdown_1.5.1   
#&gt; [21] xfun_0.14        ggdendro_0.1-20  withr_2.2.0      stringr_1.4.0   
#&gt; [25] dplyr_1.0.0      knitr_1.28       desc_1.2.0       generics_0.0.2  
#&gt; [29] fs_1.4.1         vctrs_0.3.0      glmnet_4.0       tidyselect_1.1.0
#&gt; [33] rprojroot_1.3-2  grid_4.0.0       glue_1.4.1       R6_2.4.1        
#&gt; [37] rmarkdown_2.2    farver_2.0.3     purrr_0.3.4      magrittr_1.5    
#&gt; [41] codetools_0.2-16 backports_1.1.7  scales_1.1.1     htmltools_0.4.0 
#&gt; [45] ellipsis_0.3.1   MASS_7.3-51.5    assertthat_0.2.1 shape_1.4.4     
#&gt; [49] colorspace_1.4-1 labeling_0.3     stringi_1.4.6    munsell_0.5.0   
#&gt; [53] crayon_1.3.4</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc">
      <h2 data-toc-skip>Contents</h2>
    </nav>
      </div>

</div>



      <footer>
      <div class="copyright">
  <p>Developed by Katarzyna Pekala, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


