<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Description of predict_aspects method • triplot</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- dalexverse -->
<link href="../dalexverse.css" rel="stylesheet">
<link href="../dalexverse-2.css" rel="stylesheet">

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>






<meta property="og:title" content="Description of predict_aspects method" />
<meta property="og:description" content="triplot" />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14""></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">triplot</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">1.2.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/vignette_aspect_importance.html">Triplot overview</a>
    </li>
    <li>
      <a href="../articles/vignette_aspect_importance_fifa.html">Usecase with FIFA 20 dataset</a>
    </li>
    <li>
      <a href="../articles/vignette_aspect_importance_indepth.html">Description of predict_aspects method</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/triplot/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>


<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Description of predict_aspects method</h1>
                        <h4 class="author">Katarzyna Pękala</h4>
            
            <h4 class="date">2020-06-04</h4>
      
      <small class="dont-index">Source: <a href='https://github.com/ModelOriented/triplot/blob/master/vignettes/vignette_aspect_importance_indepth.Rmd'><code>vignettes/vignette_aspect_importance_indepth.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_aspect_importance_indepth.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Predict aspects function takes on the challenge of interpreting model built on highly dimensional data. There exist a number of methods for local explanation of black-box models, like Break Down, Shap or LIME. However, the problem arises when the explanatory variables are correlated.</p>
<p>Predict aspects’ aim is to increase the interpretability of the black box model by providing instance-level and data=level explainer for the groups of explanatory variables. It enables grouping predictors into entities called aspects. Afterwards, it can calculate the contribution of those aspects to the prediction.</p>
</div>
<div id="intuition" class="section level1">
<h1>Intuition</h1>
<p>Let’s suppose that we built a model on highly dimensional data and we are using this model to predict an outcome for a new observation. We would like to gain insight which features are contributing more and which less, to this calculated prediction. However, when we calculate such importance of every single feature, the image may be still unclear, because some of those features maybe correlated. To gain better understanding, we can group those features. And afterwards, we can calculate the contribution (importance) to the prediction of every group of features (aspects). Hence the method predict aspects.</p>
<p>To achieve that goal, the method works in following way: it uses subset of observations from the original dataset and than it modifies it, so every observation will have at least one aspect (meaning at least one group of features) replaced by the data from the observation of interest. Then we will build linear model that will predict how those replacements change the prediction of the modified data.</p>
</div>
<div id="method" class="section level1">
<h1>Method</h1>
<p>We start by having dataset <span class="math inline">\(\mathcal{X}\)</span> and model <span class="math inline">\(f\)</span> built on this dataset. We would like to explain the prediction for the observation of interest <span class="math inline">\(x_*\)</span>.</p>
<p>Before we can use the method, we need to group the explanatory variables into aspects. We can use two different approaches: we can built the aspect list arbitrarily by using domain expertise or we can use <code>group_variables()</code> function that will do the grouping for us by using variables correlations. In the second approach, we are going to get aspects where every absolute value of pair-wise correlation of explanatory variables is no smaller than a given level. It should be noted that <code>group_variables()</code> works only for numerical variables.</p>
<p>The predict_aspects function algorithm starts with sampling observations from the dataset <span class="math inline">\(\mathcal{X}\)</span> into matrix <span class="math inline">\(A\)</span>.</p>
<p>Afterwards, it creates binary matrix <span class="math inline">\(X&#39;\)</span>. The number of rows of this matrix is equal to number of sampled observations in <span class="math inline">\(A\)</span>. The number of columns is equal to the number of aspects.</p>
<p>In the next step, matrix <span class="math inline">\(A\)</span> is modified into matrix <span class="math inline">\(A&#39;\)</span>. The binary matrix <span class="math inline">\(X&#39;\)</span> directs how the modification will work: for given observation from <span class="math inline">\(A\)</span>, function checks in binary matrix <span class="math inline">\(X&#39;\)</span> which aspects should be replaced by aspects from the observation of interest <span class="math inline">\(x_*\)</span>.</p>
<p>In result, we obtain a modified matrix <span class="math inline">\(A&#39;\)</span> where for every observation at least one aspect is replaced with the data from the observation of interest.</p>
<p>Next, the method checks how the aspects replacement changed the prediction. In other words, it looks at the difference between predictions for modified matrix <span class="math inline">\(A&#39;\)</span> and matrix <span class="math inline">\(A\)</span>.</p>
<p>Finally, we use linear model on the binary matrix <span class="math inline">\(X&#39;\)</span> where the difference in predictions is the dependent variable. Model’s coefficients are the results we are looking for - the values of aspects importance.</p>
<p>We can interpret coefficient <span class="math inline">\(\beta_i\)</span> as the average change in prediction caused by replacing in <span class="math inline">\(A\)</span> the variables (grouped in aspect <span class="math inline">\(i\)</span>) by the variables from <span class="math inline">\(x_*\)</span>.</p>
<p>Predict aspects algorithm:</p>
<ul>
<li><span class="math inline">\(f\)</span> - model<br />
</li>
<li><span class="math inline">\(\mathcal{X}\)</span> - dataset<br />
</li>
<li><span class="math inline">\(x_*\)</span> - observation to be explained<br />
</li>
<li><span class="math inline">\(\mathcal{P}\)</span> - aspects list, <span class="math inline">\(\mathcal{P} = {q_1, ..., q_m}\)</span>, partition of set of indexes <span class="math inline">\(J = {1, ..., p}\)</span><br />
</li>
<li><span class="math inline">\(b\)</span> - size of sample</li>
</ul>
<ol style="list-style-type: decimal">
<li><p><span class="math inline">\(A\)</span> = <span class="math inline">\([a_i^j]_{b \times p}\)</span> = select_sample(<span class="math inline">\(\mathcal{X}\)</span>, <span class="math inline">\(b\)</span>)<br />
sample (with replacement) B rows from <span class="math inline">\(\mathcal{X}\)</span></p></li>
<li><p><span class="math inline">\(X&#39;\)</span> = <span class="math inline">\([{x&#39;}_i^k]_{b \times m}\)</span> = sample_aspects(<span class="math inline">\(m\)</span>, <span class="math inline">\(b\)</span>)<br />
sample binary matrix of size <span class="math inline">\(b \times m\)</span></p></li>
<li><p><span class="math inline">\(A&#39;\)</span> = <span class="math inline">\([{a&#39;} _i^j]_{b\times p}\)</span> = replace_aspects(<span class="math inline">\(A\)</span>, <span class="math inline">\(X&#39;\)</span>)<br />
<span class="math inline">\([{a&#39;}_i^j] = [a_i^j]\)</span>, if <span class="math inline">\([{x&#39;}_i^k] = 0\)</span> where <span class="math inline">\(j \in q_k\)</span><br />
<span class="math inline">\([{a&#39;}_i^j] = x_{*j}\)</span>, if <span class="math inline">\([{x&#39;}_i^k] = 1\)</span> where <span class="math inline">\(j \in q_k\)</span></p></li>
<li><p><span class="math inline">\(Y_m = f(A&#39;) - f(A)\)</span></p></li>
<li><p>fit linear model <span class="math inline">\(g\)</span>, <span class="math inline">\(g(X&#39;) = Y_m\)</span></p></li>
</ol>
<p>return coefficients of <span class="math inline">\(g\)</span></p>
</div>
<div id="example" class="section level1">
<h1>Example</h1>
<p>To illustrate how the method works, we will use <code>Boston Housing</code> dataset from <code>mlbench</code> package. This well known dataset contains housing data for 506 census tracts of Boston. We will be predicting <strong>cmedv</strong> - corrected median value of owner-occupied homes (in USD 1000’s).</p>
<p>We are going to build two models: linear regression model and random forest. Those models will be built only on numerical variables. Then we will check the predictions for the observation called <code>new_observation</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(triplot)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(mlbench)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(DALEX)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">data</span>(<span class="st">&quot;BostonHousing2&quot;</span>)   </span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>Boston &lt;-<span class="st"> </span>BostonHousing2[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">10</span>)]</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>Boston_no_target &lt;-<span class="st"> </span>BostonHousing2[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">10</span>)]</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>new_observation &lt;-<span class="st"> </span>Boston_no_target[<span class="dv">4</span>,]</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a>Boston_lm &lt;-<span class="st"> </span><span class="kw">lm</span>(cmedv <span class="op">~</span>., <span class="dt">data =</span> Boston)</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a>Boston_rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cmedv <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> Boston)</span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="kw">predict</span>(Boston_lm, new_observation)</span></code></pre></div>
<pre><code>#&gt;        4 
#&gt; 28.78676</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">predict</span>(Boston_rf, new_observation)</span></code></pre></div>
<pre><code>#&gt;        4 
#&gt; 34.40404</code></pre>
<p>As we observe that those two models’ predictions for the <code>new_observation</code> are different, we would like to understand which groups of the observation’s features contribute to this differences. For that, we will use <code>aspects_importance()</code>.</p>
<p>In the beginning, we have to build an aspect list. Then we will call <code>aspects_importance()</code> for both of those models to check:</p>
<ul>
<li>which aspects have the biggest contribution to the prediction in each case,</li>
<li>what is minimal value of pairwise absolute correlation in each group,</li>
<li>whether any aspect contains negatively correlated pair of features (<code>neg</code>).</li>
</ul>
<p>Finally, we will plot <code>aspects_importance()</code> results for both models.</p>
<p>We can notice that in random forest model, almost every group of features (except <code>b</code> and <code>crim</code>) have positive influence on the prediction. <code>Wealth</code> (<code>rm</code> and <code>lstat</code>) has the most important contribution, it’s significantly bigger than the rest. On the other hand, in linear model we can observe that some features have negative impact (<code>geo</code>, <code>structure</code>, <code>ptartio</code>). Nonetheless, positive contribution of <code>wealth</code> is still the most important, as in random forest model. After seeing this results, we can now understand why the prediction in linear model case is smaller than in random forest one.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>Boston_aspects_m &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">geo =</span> <span class="kw">c</span>(<span class="st">&quot;dis&quot;</span>, <span class="st">&quot;nox&quot;</span>, <span class="st">&quot;rad&quot;</span>),</span>
<span id="cb5-4"><a href="#cb5-4"></a>                         <span class="dt">wealth =</span> <span class="kw">c</span>(<span class="st">&quot;rm&quot;</span>, <span class="st">&quot;lstat&quot;</span>),</span>
<span id="cb5-5"><a href="#cb5-5"></a>                         <span class="dt">structure =</span> <span class="kw">c</span>(<span class="st">&quot;indus&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;zn&quot;</span>),</span>
<span id="cb5-6"><a href="#cb5-6"></a>                         <span class="dt">ptratio =</span> <span class="st">&quot;ptratio&quot;</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>                         <span class="dt">b =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>                         <span class="dt">tax =</span> <span class="st">&quot;tax&quot;</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>                         <span class="dt">crim =</span> <span class="st">&quot;crim&quot;</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a>explain_Boston_lm &lt;-<span class="st"> </span><span class="kw">explain</span>(Boston_lm, </span>
<span id="cb5-12"><a href="#cb5-12"></a>                             Boston_no_target, </span>
<span id="cb5-13"><a href="#cb5-13"></a>                             <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a>explain_Boston_rf &lt;-<span class="st"> </span><span class="kw">explain</span>(Boston_rf, </span>
<span id="cb5-16"><a href="#cb5-16"></a>                             Boston_no_target,</span>
<span id="cb5-17"><a href="#cb5-17"></a>                             <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb5-18"><a href="#cb5-18"></a></span>
<span id="cb5-19"><a href="#cb5-19"></a>Boston_ai_lm &lt;-<span class="st"> </span><span class="kw">predict_aspects</span>(<span class="dt">x =</span> explain_Boston_lm,</span>
<span id="cb5-20"><a href="#cb5-20"></a>                                  <span class="dt">new_observation =</span> new_observation, </span>
<span id="cb5-21"><a href="#cb5-21"></a>                                  <span class="dt">variable_groups =</span> Boston_aspects_m, </span>
<span id="cb5-22"><a href="#cb5-22"></a>                                  <span class="dt">N =</span> <span class="dv">5000</span>, </span>
<span id="cb5-23"><a href="#cb5-23"></a>                                  <span class="dt">show_cor =</span> <span class="ot">TRUE</span>, </span>
<span id="cb5-24"><a href="#cb5-24"></a>                                  <span class="dt">label =</span> <span class="st">&quot;LM&quot;</span>)</span>
<span id="cb5-25"><a href="#cb5-25"></a></span>
<span id="cb5-26"><a href="#cb5-26"></a>Boston_ai_rf &lt;-<span class="st"> </span><span class="kw">predict_aspects</span>(<span class="dt">x =</span> explain_Boston_rf,</span>
<span id="cb5-27"><a href="#cb5-27"></a>                                  <span class="dt">new_observation =</span> new_observation, </span>
<span id="cb5-28"><a href="#cb5-28"></a>                                  <span class="dt">variable_groups =</span> Boston_aspects_m, </span>
<span id="cb5-29"><a href="#cb5-29"></a>                                  <span class="dt">N =</span> <span class="dv">5000</span>, </span>
<span id="cb5-30"><a href="#cb5-30"></a>                                  <span class="dt">show_cor =</span> <span class="ot">TRUE</span>, </span>
<span id="cb5-31"><a href="#cb5-31"></a>                                  <span class="dt">label =</span> <span class="st">&quot;RF&quot;</span>)</span>
<span id="cb5-32"><a href="#cb5-32"></a></span>
<span id="cb5-33"><a href="#cb5-33"></a></span>
<span id="cb5-34"><a href="#cb5-34"></a><span class="kw">print</span>(Boston_ai_lm, <span class="dt">show_features =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt;   variable_groups importance       features
#&gt; 3          wealth     7.8766      rm, lstat
#&gt; 2             geo    -3.8938  dis, nox, rad
#&gt; 7             tax     2.7309            tax
#&gt; 4       structure    -1.0264 indus, age, zn
#&gt; 8            crim     0.5362           crim
#&gt; 6               b     0.2783              b
#&gt; 5         ptratio    -0.1824        ptratio</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">print</span>(Boston_ai_rf, <span class="dt">show_features =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt;   variable_groups importance       features
#&gt; 3          wealth   11.83517      rm, lstat
#&gt; 4       structure    0.84999 indus, age, zn
#&gt; 7             tax    0.78249            tax
#&gt; 5         ptratio    0.17108        ptratio
#&gt; 2             geo    0.13439  dis, nox, rad
#&gt; 6               b   -0.01675              b
#&gt; 8            crim    0.01362           crim</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">plot</span>(Boston_ai_lm, Boston_ai_rf)</span></code></pre></div>
<p><img src="C:/Users/Katarzyna/Dropbox/r/mi2/triplot/docs/articles/vignette_aspect_importance_indepth_files/figure-html/aspect importance with manual aspects-1.png" width="700" style="display: block; margin: auto;" /></p>
<p>In some cases, manually grouping features into aspects may present some challenges. For that reason, we added function that can do that for us. Function <code>group_variables()</code> groups correlated features into aspects, given a correlation cut-off level.</p>
<p>Below we will use <code>group_variables()</code> function with a cut off level set on 0.6. As a result, we get a list of variables groups where absolute value of features’ pairwise correlation is at least at 0.6. Afterwards, we call <code>aspects_importance()</code> function again.</p>
<p>Since <code>group_variables()</code> built different list that us, we can observe a little bit different results. However, the final image still allow us to see that what we established as geographical and structure features, in general, have negative contribution on the prediction in linear case, while positive in the random forest one.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>Boston_aspects_a &lt;-<span class="st"> </span><span class="kw">group_variables</span>(Boston_no_target, <span class="fl">0.6</span>)</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a>Boston_ai_lm_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">predict_aspects</span>(<span class="dt">x =</span> explain_Boston_lm,</span>
<span id="cb10-6"><a href="#cb10-6"></a>                                    <span class="dt">new_observation =</span> new_observation, </span>
<span id="cb10-7"><a href="#cb10-7"></a>                                    <span class="dt">variable_groups =</span> Boston_aspects_a, </span>
<span id="cb10-8"><a href="#cb10-8"></a>                                    <span class="dt">N =</span> <span class="dv">10000</span>, </span>
<span id="cb10-9"><a href="#cb10-9"></a>                                    <span class="dt">show_cor =</span> <span class="ot">TRUE</span>, </span>
<span id="cb10-10"><a href="#cb10-10"></a>                                    <span class="dt">label =</span> <span class="st">&quot;LM&quot;</span>)</span>
<span id="cb10-11"><a href="#cb10-11"></a></span>
<span id="cb10-12"><a href="#cb10-12"></a>Boston_ai_rf_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">predict_aspects</span>(<span class="dt">x =</span> explain_Boston_rf, </span>
<span id="cb10-13"><a href="#cb10-13"></a>                                    <span class="dt">new_observation =</span> new_observation, </span>
<span id="cb10-14"><a href="#cb10-14"></a>                                    <span class="dt">variable_groups =</span> Boston_aspects_a, </span>
<span id="cb10-15"><a href="#cb10-15"></a>                                    <span class="dt">N =</span> <span class="dv">10000</span>, </span>
<span id="cb10-16"><a href="#cb10-16"></a>                                    <span class="dt">show_cor =</span> <span class="ot">TRUE</span>, </span>
<span id="cb10-17"><a href="#cb10-17"></a>                                    <span class="dt">label =</span> <span class="st">&quot;RF&quot;</span>)</span>
<span id="cb10-18"><a href="#cb10-18"></a></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="kw">print</span>(Boston_ai_lm_<span class="dv">2</span>, <span class="dt">show_features =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt;   variable_groups importance                   features
#&gt; 4   aspect.group3     8.0082                  rm, lstat
#&gt; 2   aspect.group1    -1.8763 crim, indus, nox, age, dis
#&gt; 3   aspect.group2    -0.5785                         zn
#&gt; 5   aspect.group4     0.4270                   rad, tax
#&gt; 6   aspect.group5    -0.2934                    ptratio
#&gt; 7   aspect.group6     0.2445                          b</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">print</span>(Boston_ai_rf_<span class="dv">2</span>, <span class="dt">show_features =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt;   variable_groups importance                   features
#&gt; 4   aspect.group3   11.70089                  rm, lstat
#&gt; 2   aspect.group1    1.28194 crim, indus, nox, age, dis
#&gt; 5   aspect.group4    0.71031                   rad, tax
#&gt; 6   aspect.group5    0.25228                    ptratio
#&gt; 3   aspect.group2    0.06615                         zn
#&gt; 7   aspect.group6    0.02603                          b</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">plot</span>(Boston_ai_lm_<span class="dv">2</span>, Boston_ai_rf_<span class="dv">2</span>, <span class="dt">aspects_on_axis =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="C:/Users/Katarzyna/Dropbox/r/mi2/triplot/docs/articles/vignette_aspect_importance_indepth_files/figure-html/aspect importance with automated aspects-1.png" width="700" style="display: block; margin: auto;" /></p>
</div>
<div id="hierarchical-aspects-importance" class="section level1">
<h1>Hierarchical aspects importance</h1>
<p><code>Triplot</code> is a tool built on <code>aspects_importance</code> function, that allows us to go one step further in our understanding of the inner workings of a black box model.</p>
<p>It illustrates, in one place:</p>
<ul>
<li>the importance of every single feature,</li>
<li>hierarchical aspects importance (explained below),</li>
<li>order of grouping features into aspects in <code>group_variables()</code>.</li>
</ul>
<p>Hierarchical aspects importance allows us to check the values of aspects importance for the different levels of variables grouping. Method starts with looking at the aspect importance where every aspect has one, single variable. Afterwards, it iteratively creates bigger aspects by merging the ones with the highest level of absolute correlation into one aspect and calculating it’s contribution to the prediction.</p>
<p>It should be noted that similarly to <code>group_variables()</code>, <code>calculate_triplot()</code> works for the datasets with only numerical variables.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>tri_lm &lt;-<span class="st"> </span><span class="kw">predict_triplot</span>(<span class="dt">x =</span> explain_Boston_lm, </span>
<span id="cb15-4"><a href="#cb15-4"></a>                            <span class="dt">new_observation =</span> new_observation, </span>
<span id="cb15-5"><a href="#cb15-5"></a>                            <span class="dt">N =</span> <span class="dv">10000</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="kw">plot</span>(tri_lm,</span>
<span id="cb15-8"><a href="#cb15-8"></a>     <span class="dt">margin_mid =</span> <span class="fl">0.2</span>, </span>
<span id="cb15-9"><a href="#cb15-9"></a>     <span class="dt">show_model_label =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="C:/Users/Katarzyna/Dropbox/r/mi2/triplot/docs/articles/vignette_aspect_importance_indepth_files/figure-html/triplot-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>tri_rf &lt;-<span class="st"> </span><span class="kw">predict_triplot</span>(<span class="dt">x =</span> explain_Boston_rf, </span>
<span id="cb16-2"><a href="#cb16-2"></a>                            <span class="dt">new_observation =</span> new_observation, </span>
<span id="cb16-3"><a href="#cb16-3"></a>                            <span class="dt">N =</span> <span class="dv">10000</span>)</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="kw">plot</span>(tri_rf,</span>
<span id="cb16-5"><a href="#cb16-5"></a>     <span class="dt">margin_mid =</span> <span class="fl">0.2</span>,</span>
<span id="cb16-6"><a href="#cb16-6"></a>     <span class="dt">add_last_group =</span> <span class="ot">TRUE</span>,</span>
<span id="cb16-7"><a href="#cb16-7"></a>     <span class="dt">show_model_label =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="C:/Users/Katarzyna/Dropbox/r/mi2/triplot/docs/articles/vignette_aspect_importance_indepth_files/figure-html/triplot-2.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="lasso" class="section level1">
<h1>Lasso</h1>
<p>Behind the scenes, aspect importance numbers are really linear model coefficients. That allowed us to add one more tool to control the method result. By using lasso regression, we can control how many nonzero coefficients (nonzero aspects importance values) are present in the final explanation. To use <code>predict_aspects()</code> with lasso, we have to provide <code>n_var</code> parameter, which declares how many aspects importance values we would like to get in <code>predict_aspects()</code> results.</p>
<p>Suppose that in our last example (random forest model with aspect list build by <code>group_variables</code>), we would like to calculate the importance of variables’ aspects, while controlling that three of them should be equal to 0. We will call <code>predict_aspects()</code> on this model, with <code>n_var</code> parameter set to 3.</p>
<p>In result, we get what we expected - three nonzero aspect importance values. We can observe that there exists significant difference between the level of contribution of aspect containing <code>rm</code> and <code>lstat</code> features and the other two groups.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>ai_Boston_rf &lt;-<span class="st"> </span><span class="kw">predict_aspects</span>(<span class="dt">x =</span> explain_Boston_rf, </span>
<span id="cb17-4"><a href="#cb17-4"></a>                                <span class="dt">new_observation =</span> new_observation,</span>
<span id="cb17-5"><a href="#cb17-5"></a>                                <span class="dt">variable_groups =</span> Boston_aspects_a,</span>
<span id="cb17-6"><a href="#cb17-6"></a>                                <span class="dt">N =</span> <span class="dv">10000</span>,</span>
<span id="cb17-7"><a href="#cb17-7"></a>                                <span class="dt">n_var =</span> <span class="dv">3</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="kw">print</span>(ai_Boston_rf, <span class="dt">show_features =</span> <span class="ot">TRUE</span>, <span class="dt">show_cor =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt;   variable_groups importance                   features   min_cor sign
#&gt; 4   aspect.group3    11.0997                  rm, lstat 0.6408316  neg
#&gt; 2   aspect.group1     0.4282 crim, indus, nox, age, dis 0.6794867  neg
#&gt; 7   aspect.group6    -0.0054                          b        NA     
#&gt; 3   aspect.group2     0.0000                         zn        NA     
#&gt; 5   aspect.group4     0.0000                   rad, tax 0.7048757  pos
#&gt; 6   aspect.group5     0.0000                    ptratio        NA</code></pre>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>Predict aspects allow us to check how the level of prediction is influenced by the different groups of features. We added additional tools to this method that let us group features automatically, control how many nonzero values are in the method results or see how aspect importance values are changing while aspects are one by one increasing in size (hierarchical aspects importance).</p>
<p>However, we still see place for experimenting with stability of the results (size of the subset used by the <code>predict_aspects</code>), clarity of triplot and with lasso regression as the method extensions.</p>
</div>
<div id="session-info" class="section level1">
<h1>Session info</h1>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>#&gt; R version 4.0.0 (2020-04-24)
#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)
#&gt; Running under: Windows 10 x64 (build 18362)
#&gt; 
#&gt; Matrix products: default
#&gt; 
#&gt; locale:
#&gt; [1] LC_COLLATE=Polish_Poland.1250  LC_CTYPE=Polish_Poland.1250   
#&gt; [3] LC_MONETARY=Polish_Poland.1250 LC_NUMERIC=C                  
#&gt; [5] LC_TIME=Polish_Poland.1250    
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] DALEX_1.2.1         randomForest_4.6-14 mlbench_2.1-1      
#&gt; [4] triplot_1.2.0      
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.4.6     compiler_4.0.0   pillar_1.4.4     iterators_1.0.12
#&gt;  [5] tools_4.0.0      digest_0.6.25    lattice_0.20-41  evaluate_0.14   
#&gt;  [9] memoise_1.1.0    lifecycle_0.2.0  tibble_3.0.1     gtable_0.3.0    
#&gt; [13] pkgconfig_2.0.3  rlang_0.4.6      foreach_1.5.0    Matrix_1.2-18   
#&gt; [17] rstudioapi_0.11  patchwork_1.0.0  yaml_2.2.1       pkgdown_1.5.1   
#&gt; [21] xfun_0.14        ggdendro_0.1-20  stringr_1.4.0    dplyr_1.0.0     
#&gt; [25] knitr_1.28       desc_1.2.0       generics_0.0.2   fs_1.4.1        
#&gt; [29] vctrs_0.3.0      glmnet_4.0       rprojroot_1.3-2  grid_4.0.0      
#&gt; [33] tidyselect_1.1.0 glue_1.4.1       R6_2.4.1         rmarkdown_2.2   
#&gt; [37] farver_2.0.3     purrr_0.3.4      ggplot2_3.3.1    magrittr_1.5    
#&gt; [41] codetools_0.2-16 backports_1.1.7  scales_1.1.1     htmltools_0.4.0 
#&gt; [45] ellipsis_0.3.1   MASS_7.3-51.5    assertthat_0.2.1 shape_1.4.4     
#&gt; [49] colorspace_1.4-1 labeling_0.3     stringi_1.4.6    munsell_0.5.0   
#&gt; [53] crayon_1.3.4</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc">
      <h2 data-toc-skip>Contents</h2>
    </nav>
      </div>

</div>



      <footer>
      <div class="copyright">
  <p>Developed by Katarzyna Pekala, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


